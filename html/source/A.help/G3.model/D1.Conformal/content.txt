# 共形技术
为了解决FDTD的Yee网格所产生的阶梯误差，新版中加入了修改FDTD基本迭代式或修改网格场量材料属性的共形技术。
新版共形分为PEC（PMC）共形和材料（除PEC（PMC）以外的无色散材料和色散材料）共形。具体设置界面如下：
[image]("image/conformal/conformal_interface.png","",".atf")
[block-ref](conformal-input-table)
```tips:warning-注意
非PEC(PMC)材料共形只有在PEC和PMC共形开启时才开启，即使计算结构内无PEC、PMC也必须开启PEC和PMC共形
才能使用材料共形。
```
## SC策略
PEC(PMC)共形会造成时间步的严重下降，会急剧增加计算时间。SC策略通过牺牲一定计算精度，
使得计算的时间步保持在一个可容忍的范围。SC基于Dey-Mittra共形技术，但对某些共形线段的
长度数据进行更改，从而避免时间步的减小。下面以PEC共形为例介绍SC策略基本原理:
[anchor](".mypic")
[image]("image/conformal/SC.png","",".atf")
+ 对PEC部分填充的网格，求得非PEC所占比例。即对网格面，求得非PEC所占的面积与该网格面积的比例；
  对于网格线段，求得非PEC部分的线段长度与该网格线段长度的比例。以[link]("?.mypic","图")为例我们将非PEC线段和面积占比分别用
  $r_{l1}$、$r_{l2}$、$r_{l3}$和$r_s$表示，当$r_l$与$r_s$比值过大时，容易使得计算不稳定，必须减小时间步。
+ 为了在保持一定精度下，使得时间步更为接近$dt_{courant}$，非PEC线段比例$r_{ln}$将按$r^{new}_{ln}=min⁡(2SC_{eff}r_{s},r_{ln} )$
  重新调整为$r^{new}_{ln}$，其中$SC_{eff}$即为SC精度值；
+ 可以看到$SC_{eff}$值必须大于等于0才有意义，当$SC_{eff}$很大时，不会对Dey-Mittra的PEC共形做任何
  更高，此时计算精度最高，但时间步会减小；$SC_{eff}$一般建议取2至3。
```block:conformal-level-list-pec
+ 关闭：不启用,场量材料属性由场量所在位置的材料决定
+ 级别1：线段中有PEC材料，则认为整段是PEC材料
+ 级别2：线段中只允许一段非PEC材料，不满足的情况下根据具体情况退化为一段或填充为PEC
+ 级别3：线段中允许有两段非PEC材料
```

```block:conformal-level-list-pmc
+ 关闭：不启用,场量材料属性由场量所在位置的材料决定
+ 级别1：线段中有PMC材料，则认为整段是PMC材料
+ 级别2：线段中只允许一段非PMC材料，不满足的情况下根据具体情况退化为一段或填充为PMC
+ 级别3：线段中允许有两段非PMC材料
```

```block:conformal-input-table
||(,".atfi")
|(1,2) 选项 |(L) 描述 |(L)备注 |
|(1,2) PEC共形级别 |(L) [block-ref](conformal-level-list-pec) |(L)  |
|(,2) PMC共形级别 |(L) [block-ref](conformal-level-list-pmc) |(L)  |
|(2,1) 非PEC(PMC)材料共形|(L) 材料线策略 |(L) 普通材料线策略选项，包括：无（不开启普通材料线共形）、线分段（材料分段策略）、线平均（材料参数按长度比例几何平均） |(L) 精度要求高时建议采用**线分段**策略  |
| 材料面策略 |(L) 普通材料面策略选项，包括：无（不开启普通材料面共形）、平均（材料参数几何平均） |(L) 面共形的平均策略和线共形平均策略类似，都是材料参数的几何平均，线共形按网格线段中的材料长度比例平均，面共形按照回路中材料面积比例平均  |
|(1,2) SC策略 |(L) SC共形精度值决定共形的精度，值越小时间步越接近Courant时间步，同时精度越低 |(L) SC共形精度值必须大于等于0，小于0时SC策略失效|
```